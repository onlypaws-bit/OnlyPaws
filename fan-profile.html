<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>OnlyPaws ‚Äî Fan Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg1:#6B4EFF;
  --bg2:#8B6CFF;
  --text:#ffffff;
  --muted:rgba(255,255,255,.85);
  --stroke:rgba(255,255,255,.16);
  --card:rgba(0,0,0,.16);
  --shadow: rgba(0,0,0,.25);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: Arial, sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.18), transparent 55%),
    radial-gradient(1000px 650px at 90% 30%, rgba(0,0,0,.22), transparent 55%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  min-height:100vh;
}

.wrap{max-width:1040px;margin:0 auto;padding:28px 18px 60px;}

.nav{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:20px;
}

.brand{
  text-decoration:none;color:white;font-weight:900;
}

.panel{
  border-radius:22px;
  padding:22px;
  background:var(--card);
  border:1px solid var(--stroke);
  backdrop-filter:blur(10px);
  box-shadow:0 20px 45px var(--shadow);
}

.grid{
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:14px;
}

@media(max-width:900px){
  .grid{grid-template-columns:1fr;}
}

h1{margin:0 0 10px;font-size:2rem}

.meta{opacity:.9;font-size:14px;margin-top:6px}

.miniGrid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  margin-top:14px;
}

.miniCard{
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.16);
  border-radius:16px;
  padding:12px;
}

.miniK{font-size:12px;opacity:.9}
.miniV{font-size:20px;font-weight:900;margin-top:4px}

.list{
  margin-top:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.listItem{
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.16);
  text-decoration:none;
  color:white;
}

.hint{margin-top:10px;font-size:13px;opacity:.85}

/* ===== GLOBAL FOOTER (IDENTICO A CREATORS) ===== */

.globalFooter {
  text-align: center;
  padding: 30px 20px;
  font-size: 14px;
  opacity: 0.9;
  line-height: 1.6;
}

.globalFooter .small {
  margin-top: 6px;
  font-size: 13px;
  opacity: 0.8;
}

.globalFooter .footerLinks {
  margin-top: 14px;
}

.globalFooter a {
  color: rgba(255,255,255,0.9);
  text-decoration: none;
  opacity: 0.85;
  transition: opacity 0.2s ease, text-decoration 0.2s ease;
}

.globalFooter a:hover {
  text-decoration: underline;
  opacity: 1;
}

</style>
</head>

<body>

<div class="wrap">

  <div class="nav">
    <a href="feed.html" class="brand">OnlyPaws</a>
  </div>

  <div class="grid">

    <div class="panel">
      <h1 id="fanName">Fan</h1>
      <div class="meta" id="fanHandle">@username</div>
      <div class="meta" id="fanBio"></div>

      <div class="miniGrid">
        <div class="miniCard">
          <div class="miniK">Following</div>
          <div class="miniV" id="statFollowing">‚Äî</div>
        </div>
        <div class="miniCard">
          <div class="miniK">Subscriptions</div>
          <div class="miniV" id="statSubscriptions">‚Äî</div>
        </div>
      </div>

      <div class="hint" id="fanHint"></div>
    </div>

    <div class="panel">
      <h2 style="margin:0 0 10px;">Creators followed</h2>
      <div class="list" id="followingList"></div>
      <div class="hint" id="followingHint">Loading‚Ä¶</div>
    </div>

  </div>
</div>

<footer class="globalFooter">
  <div>
    ¬© 2026 OnlyPaws ‚Ä¢ Built with toe beans energy üêæ
  </div>

  <div class="small">
    OnlyPaws is an independent digital platform. Features may evolve over time.
  </div>

  <div class="footerLinks">
    <a href="content-policy.html">Content Policy</a>
    &nbsp;¬∑&nbsp;
    <a href="privacy-policy.html">Privacy Policy</a>
    &nbsp;¬∑&nbsp;
    <a href="terms.html">Terms of Service</a>
    &nbsp;¬∑&nbsp;
    <a href="mailto:onlypawssupp@gmail.com">Contact Us</a>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

function getParam(){
  const p=new URLSearchParams(window.location.search);
  return p.get("u");
}

async function loadFan(){
  const u=getParam();
  if(!u){
    document.getElementById("fanHint").textContent="Missing ?u=username";
    return;
  }

  const {data:fan,error}=await onlypawsClient
    .from("profiles")
    .select("user_id,username,display_name,bio")
    .eq("username",u)
    .maybeSingle();

  if(error||!fan){
    document.getElementById("fanHint").textContent="Fan not found";
    return;
  }

  document.getElementById("fanName").textContent =
    fan.display_name||fan.username;

  document.getElementById("fanHandle").textContent =
    "@"+fan.username;

  document.getElementById("fanBio").textContent =
    fan.bio||"";

  const {count:following}=await onlypawsClient
    .from("followers")
    .select("id",{count:"exact",head:true})
    .eq("fan_id",fan.user_id);

  const {count:subs}=await onlypawsClient
    .from("creator_subscriptions")
    .select("id",{count:"exact",head:true})
    .eq("fan_id",fan.user_id)
    .eq("is_active",true);

  document.getElementById("statFollowing").textContent =
    following||0;

  document.getElementById("statSubscriptions").textContent =
    subs||0;

  const {data:rows}=await onlypawsClient
    .from("followers")
    .select("creator_id")
    .eq("fan_id",fan.user_id);

  if(!rows||rows.length===0){
    document.getElementById("followingHint").textContent="No creators yet.";
    return;
  }

  const ids=rows.map(r=>r.creator_id);

  const {data:creators}=await onlypawsClient
    .from("profiles")
    .select("username,display_name")
    .in("user_id",ids);

  document.getElementById("followingHint").textContent="";

  document.getElementById("followingList").innerHTML =
    creators.map(c=>`
      <a class="listItem" href="creator-profile.html?u=${c.username}">
        ${c.display_name||c.username}
      </a>
    `).join("");
}

loadFan();

</script>

</body>
</html>
