<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OnlyPaws ‚Äî Purchased Posts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg1:#6B4EFF;
      --bg2:#8B6CFF;
      --text:#ffffff;
      --muted:rgba(255,255,255,.85);
      --stroke:rgba(255,255,255,.16);
      --card:rgba(0,0,0,.16);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(1000px 650px at 90% 30%, rgba(0,0,0,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1040px;margin:0 auto;padding:28px 18px 90px;}

    /* NAV */
    .nav{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:18px;}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:white;font-weight:900;}
    .brandLogo{
      width:62px;height:62px;border-radius:14px;
      background: rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.18);
      display:flex;align-items:center;justify-content:center;
    }
    .brandLogo img{width:46px;height:46px;object-fit:contain;}
    .navRight{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .pill{
      padding:8px 14px;border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      font-size:13px;color:rgba(255,255,255,.85);
      white-space:nowrap;
    }
    .navBtn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:10px 14px;border-radius:999px;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      color:white;text-decoration:none;font-weight:900;
      cursor:pointer;font-size:13px;white-space:nowrap;
      transition:transform .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
    }
    .navBtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22);}
    .navBtn:active{transform: translateY(0px) scale(.99);}

    /* CONTENT */
    .panel{
      border-radius:22px;padding:22px;
      background: var(--card);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      box-shadow:0 20px 45px rgba(0,0,0,.25);
    }
    h1{margin:0 0 6px;font-size: clamp(2rem, 4vw, 2.4rem);letter-spacing:-0.6px;}
    .sub{margin:0;color:var(--muted);line-height:1.55}

    .list{margin-top:14px;display:grid;gap:10px;}
    .item{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      border-radius:16px;
      padding:12px 14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .left{min-width:0}
    .title{font-weight:900}
    .meta{font-size:13px;color:rgba(255,255,255,.82);margin-top:4px}
    .msg{margin-top:10px;font-size:13px;color:rgba(255,255,255,.85);min-height:18px}

    footer{
      margin-top:32px;
      padding-bottom:22px;
      color:rgba(255,255,255,.75);
      font-size:13px;
      text-align:center;
      line-height:1.5;
    }
    .smallLegal{display:inline-block;margin-top:6px;opacity:.85;font-size:12px;}
  </style>
</head>

<body>
  <div class="wrap">

    <div class="nav">
      <a href="feed.html" class="brand">
        <div class="brandLogo"><img src="logo.png" alt="OnlyPaws logo"></div>
        <span>OnlyPaws</span>
      </a>

      <div class="navRight">
        <div class="pill" id="userPill">‚Ä¶</div>
        <a class="navBtn" id="navProfile" href="profile.html" style="display:none;">Profile</a>
        <a class="navBtn" id="navFanDash" href="fan-dash.html" style="display:none;">Dashboard</a>
        <a class="navBtn" id="navCreatorDash" href="creator-dash.html" style="display:none;">Dashboard</a>
        <button class="navBtn" id="navLogout" type="button" style="display:none;">Log out</button>
      </div>
    </div>

    <div class="panel">
      <h1>Purchased posts</h1>
      <p class="sub">Posts you bought (one-time purchases). This page will show your purchases only.</p>

      <div class="list" id="purchasesList"></div>
      <div class="msg" id="msg"></div>
    </div>

    <footer>
      ¬© 2026 OnlyPaws ‚Ä¢ Built with toe beans energy üêæ<br/>
      <span class="smallLegal">OnlyPaws is an independent digital platform. Features may evolve over time.</span>
    </footer>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>

  <script>
    const msg = document.getElementById("msg");
    const list = document.getElementById("purchasesList");
    const navLogout = document.getElementById("navLogout");

    function show(el, yes){
      if(!el) return;
      el.style.display = yes ? "inline-flex" : "none";
    }

    async function requireSession(){
      const { data } = await onlypawsClient.auth.getSession();
      if(!data?.session){
        window.location.href = "fans.html?next=purchased-posts.html";
        return null;
      }
      return data.session;
    }

    async function hydrateUserPill(){
      try{
        const pill = document.getElementById("userPill");
        if(!pill) return;

        const { data: sessData } = await onlypawsClient.auth.getSession();
        const session = sessData?.session;
        if(!session){ pill.textContent = "Guest"; return; }

        const uid = session.user.id;
        const email = session.user.email || "";

        const { data: prof } = await onlypawsClient
          .from("profiles")
          .select("username, display_name, role")
          .eq("user_id", uid)
          .maybeSingle();

        const uname = (prof?.username || "").trim();
        const dname = (prof?.display_name || "").trim();

        if(uname) pill.textContent = "@" + uname;
        else if(dname) pill.textContent = dname;
        else if(email) pill.textContent = email.split("@")[0];
        else pill.textContent = "User";
      }catch(e){}
    }

    async function hydrateNav(){
      const profileBtn = document.getElementById("navProfile");
      const fanDash = document.getElementById("navFanDash");
      const creatorDash = document.getElementById("navCreatorDash");

      show(profileBtn, true);
      show(navLogout, true);
      show(fanDash, false);
      show(creatorDash, false);

      try{
        const { data: u } = await onlypawsClient.auth.getUser();
        const userId = u?.user?.id;
        if(!userId) return;

        const { data: p } = await onlypawsClient
          .from("profiles")
          .select("role")
          .eq("user_id", userId)
          .maybeSingle();

        if(p?.role === "creator") show(creatorDash, true);
        else show(fanDash, true);
      }catch(e){}
    }

    function emptyState(){
      list.innerHTML = "";
      list.appendChild(Object.assign(document.createElement("div"), {
        className: "item",
        innerHTML: `
          <div class="left">
            <div class="title">No purchases yet</div>
            <div class="meta">When you buy a post, it will appear here.</div>
          </div>
        `
      }));
    }

    // Placeholder loader (we‚Äôll wire to DB next)
    async function loadPurchasedPosts(){
      msg.textContent = "Coming next: wire this to purchases table + join posts üêæ";
      emptyState();
    }

    navLogout.addEventListener("click", async () => {
      try{ await onlypawsClient.auth.signOut(); }catch(e){}
      window.location.href = "index.html";
    });

    (async () => {
      if(typeof onlypawsClient === "undefined"){
        msg.textContent = "‚ùå onlypawsClient not found. Check supabase.js.";
        return;
      }

      const session = await requireSession();
      if(!session) return;

      await hydrateNav();
      await hydrateUserPill();
      await loadPurchasedPosts();
    })();
  </script>
</body>
</html>